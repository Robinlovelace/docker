---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


# Geocomputation with R in Docker

<!-- badges: start -->
[![](https://img.shields.io/docker/pulls/geocompr/geocompr.svg)](https://hub.docker.com/r/geocompr/geocompr:)
<!-- badges: end -->

This repo provides docker images on which to run code in *Geocomputation with R*.
Docker can save time by removing pain and reducing time associated with setting-up your operating system to work with the latest geographic packages.

To get started, after you [install Docker](https://docs.docker.com/get-docker/), try running the following command:

```{r, engine='bash', eval=FALSE}
docker run -e PASSWORD=pw --rm -p 8786:8787 geocompr/geocompr
```

Then open a browser at http://localhost:8786/ and you should see something like this:

![](https://user-images.githubusercontent.com/1825120/79639334-33eb9f00-8183-11ea-8358-588fe17afe25.png)
If so congratulations ðŸŽ‰

If not, see documentation on using Docker at websites such as [docker.com](https://docs.docker.com/get-started/) and https://www.rocker-project.org/.

## Versions

Building on the [rocker-org](https://github.com/rocker-org/rocker-versioned/blob/master/README.md)  project, we provide various versions for testing and development, as shown below:



image            | description                               | size   
---------------- | ----------------------------------------- | ------ 
[geocompr](https://hub.docker.com/r/geocompr/geocompr) |  Default repos on Ubuntu  | ![](https://img.shields.io/docker/image-size/geocompr/geocompr?sort=date) 
[geocompr:default_repos](https://hub.docker.com/r/geocompr/geocompr)            |  Default repos on Ubuntu  | ![](https://img.shields.io/docker/image-size/geocompr/geocompr/default_repos)
[geocompr:ubuntugis_stable](https://hub.docker.com/r/geocompr/geocompr)            |  UbuntuGIS stable repo  | ![](https://img.shields.io/docker/image-size/geocompr/geocompr/ubuntugis_stable)
[geocompr:ubuntugis_unstable](https://hub.docker.com/r/geocompr/geocompr)            |  Default repos on Ubuntu  | ![](https://img.shields.io/docker/image-size/geocompr/geocompr/ubuntugis_unstable)
[geocompr:rstudio_preview](https://hub.docker.com/r/geocompr/geocompr)            |  UbuntuGIS Unstable repos and RStudio Preview  | ![](https://img.shields.io/docker/image-size/geocompr/geocompr/rstudio_preview)
[geocompr:rstudio_devel](https://hub.docker.com/r/geocompr/geocompr)            |  UbuntuGIS Unstable repos and R devel  | ![](https://img.shields.io/docker/image-size/geocompr/geocompr/rstudio_devel)

Add :tagname to geocompr/geocompr to get the tag you're interested in.

To run the `rstudio_preview` version, for example, run the following command (with port and password set to a port of your preference):

```{r, engine='bash', eval=FALSE}
docker run -e PASSWORD=pw --rm -p 8786:8787 geocompr/geocompr:rstudio_preview
```

Adding `_buildbook` to a tag will give you an image with the pre-built book (added by default in the `rstudio_` versions), e.g.:

```{r, engine='bash', eval=FALSE}
docker run -e PASSWORD=pw --rm -p 8786:8787 geocompr/geocompr:ubuntugis_unstable_buildbook
```

## Details


The base image is `rockerdev/geospatial:3.6.3` from [github.com/rocker-org/rocker-versioned2](https://github.com/rocker-org/rocker-versioned2/blob/master/dockerfiles/Dockerfile_geospatial_3.6.3).

To build on different system configurations we provide tags that correspond to the following categories:

`baseimage-ubuntugis-setup-rpackages-buildbook`

The default base image is `rockerdev/geospatial:3.6.3`.
More images may be added in the future.


```{r}
baseimage = c(
  rockerdev_geospatial_3.6.3 = ""
)
```

Ubuntugis options include using the `ubuntugis-unstable` and `ubuntugis-stable` repos.

```{r}
ubuntugis = c(
  no_ubuntugis = "default_repos",
  ubuntugis_unstable = "ubuntugis_unstable",
  ubuntugis_stable = "ubuntugis_stable"
)
```

Setup options can include RStudio settings (yet to be added).

R package options relate to which R packages are installed on the image (yet to be added).

Buildbook options report whether or not the book is built:

```{r}
buildbook = c(
  no = "",
  yes = "buildbook"
)
```

We will create a 'build matrix' covering all combinations of these options (excluding the base image for now):

```{r}
g = expand.grid(ubuntugis, buildbook, stringsAsFactors = FALSE)
g
```

These can be converted into tags as follows:

```{r}
tag_df = tidyr::unite(g, tag)
tags = gsub(pattern = "__|^_|_$", replacement = "", tag_df$tag)
tags
```

We could write code to auto-generate Dockerfiles, as demonstrated in [rocker-org/rocker-versioned2](https://github.com/rocker-org/rocker-versioned2).

For now, to start the project going, we will manually edit the files, which can be created as follows:

```{r, eval=FALSE}
new_dockerfiles = paste0("dockerfiles/Dockerfile_", tags)
new_dockerfiles
lapply(new_dockerfiles, file.copy, from = "rockerdev-ubuntugis-bookbuild/Dockerfile", TRUE)
```

Edit these files as appropriate:

```{r, eval=FALSE}
file.edit("dockerfiles/Dockerfile_ubuntugis_unstable")
```

Create a folder for each Dockerfile:

```{r, eval=FALSE}
lapply(tags, dir.create)
lapply(tags, function(x) {
  file.copy(
    from = paste0("dockerfiles/Dockerfile_", x),
    , to = paste0(x, "/Dockerfile"),
    overwrite = TRUE)
})
```

Test the build in a terminal, e.g. with the following command

```bash
docker build ubuntugis_unstable
```
